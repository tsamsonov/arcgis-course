# (PART) Базовые технологии ГИС {-}

# Привязка и векторизация (туристская карта) {#map-ref-general}



[Скачать данные и файл отчета](https://carto.geogr.msu.ru/gis/data/Ex05.zip)

## Введение {#map-ref-general-intro}

**Цель задания** --- знакомство с привязкой, трансформированием и векторизацией растровых геоизображений.

Параметр                    Значение
--------------------------  --------
*Теоретическая подготовка*  Системы координат и проекции на картах, привязка геоизображений, трансформирование геоизображений, цифрование геоизображений. Методы трансформации: аффинное, проективное, полиномиальное, метод резинового листа (сплайны).
*Практическая подготовка*   Знание основных компонент интерфейса ArcGIS Desktop (каталог, таблица содержания, карта). Работа с базой геоданных. Настройка символики и подписей объектов.
*Исходные данные*           Растровые карты для привязки, база пространственных данных на территорию Швейцарии.
*Результат*                 База данных со следующими слоями: границы природных зон; линии туристического маршрута; остановки вдоль маршрута; проект карты карта с компоновкой
*Ключевые слова*            Системы координат, проекции, трансформирование координат, пространственная привязка, цифрование, векторизация, классы пространственных объектов, база пространственных данных,

### Контрольный лист {#map-ref-general-control}

* Привязать растровые карты к опорным данным
* Создать базу геоданных и классы пространственных объектов
* Наполнить классы пространственных объектов путем векторизации привязанных карт
* Наполнить атрибуты объектов значениями
* Разработать символику и подписи для слоев карты
* Подготовить компоновку карты
* Экспортировать карту в графический файл

### Аннотация {#map-ref-general-anno}

Задание посвящено знакомству с привязкой растровых карт, созданием и наполнением баз пространственных данных путем их векторизации, оформлением карт на их основе.

В задании предлагается привязать в координатную систему карту природных зон и карту туристического маршрута по территории Швейцарии. По результатам векторизации этих карт вы составите туристскую карту, показывающую прохождение маршрута по разным природным зонам.

## Привязка карт {#map-ref-general-referencing}
[В начало упражнения ⇡](#map-ref-general)

### Карта физико-географических регионов {#map-ref-general-referencing-phys}

1. Внимательно прочтите раздел [**Привязка растровых данных (Georeferencing)**](#manual-georef) в разделе **Описание функций**.

1. Добавьте на карту слой *Countries* из базы данных упражнения 3.

1. Добавьте на карту растр *SwissRegions.gif*. Появится диалог, предупреждающий вас, что добавляемый файл не имеет пространственной привязки. Нажмите **ОК** (Рис. \@ref(fig:mrg-noref)):
    
    <div class="figure">
    <img src="images/Ex05/image8.png" alt="Предупреждение о неизвестной пространственной привязке" width="100%" />
    <p class="caption">(\#fig:mrg-noref)Предупреждение о неизвестной пространственной привязке</p>
    </div>

1. Убедитесь, что контур страны отображается примерно посередине экрана.

1. Откройте панель инструментов **Georeferencing**. Выберите в меню команду **Fit to Display**, чтобы переместить непривязанный растр на середину области отображения (Рис. \@ref(fig:mrg-fit)):
    
    <div class="figure">
    <img src="images/Ex05/image9.png" alt="Вписывание изображения в экран с помощью панели Georeferencing" width="100%" />
    <p class="caption">(\#fig:mrg-fit)Вписывание изображения в экран с помощью панели Georeferencing</p>
    </div>

1. Сделайте растровый слой прозрачным на *50%*.

1. Используя **инструмент расстановки контрольных точек**, укажите *3-6* соответствующих точек по границе страны на характерных выступах контура (Рис. \@ref(fig:mrg-ctr)):
    
    <div class="figure">
    <img src="images/Ex05/image10.png" alt="Инструмент расстановки контрольных точек" width="100%" />
    <p class="caption">(\#fig:mrg-ctr)Инструмент расстановки контрольных точек</p>
    </div>
    
1. Выберите команду меню **Georeferencing > Update Georeferencing**, чтобы завершить привязку растра. При этом по умолчанию будет применено аффинное преобразование с минимизацией среднеквадратической ошибки отклонения исходных и целевых координат (Рис. \@ref(fig:mrg-upd)):
    
    <div class="figure">
    <img src="images/Ex05/image11.png" alt="Привязанная карта физико-географических регионов" width="100%" />
    <p class="caption">(\#fig:mrg-upd)Привязанная карта физико-географических регионов</p>
    </div>

<kbd>**Снимок экрана №1**. Привязанная карта физико-географических регионов</kbd>

### Карта туристического маршрута {#map-ref-general-referencing-tourist}

1. Добавьте на карту слой *WineSafariRoute.jpg*.

1. Выберите его в списке на панели **Georeferencing** (Рис. \@ref(fig:mrg-lyr)):

    <div class="figure">
    <img src="images/Ex05/image12.png" alt="Выбор слоя для привязки" width="80%" />
    <p class="caption">(\#fig:mrg-lyr)Выбор слоя для привязки</p>
    </div>

1. Отключите слой *SwissRegions.gif* в таблице содержания.

1. Привяжите растр *WineSafariRoute* аналогично предыдущему растру, используя контрольные точки (Рис. \@ref(fig:mrg-rou)):

    <div class="figure">
    <img src="images/Ex05/image13.png" alt="Привязка карты маршрута по контрольным точкам" width="100%" />
    <p class="caption">(\#fig:mrg-rou)Привязка карты маршрута по контрольным точкам</p>
    </div>

1. Выберите команду **Georeferencing > Update georeferencing**, чтобы завершить привязку второго растра.

<kbd>**Снимок экрана №2**. Привязанная карта маршрута</kbd>

## Создание базы данных и классов пространственных объектов {#map-ref-general-geodatabase}
[В начало упражнения ⇡](#map-ref-general)

1. Прочитайте параграф [**База геоданных**](#manual-gdb) в разделе **Описание функций**.

1. Создайте в папке *Ex05* базу геоданных под названием *RouteMap.gdb*.

1. Создайте в базе данных *классы пространственных объектов* со следующими параметрами:

Название  Модель пространственных объектов  Атрибутивные поля Проекция
--------  --------------------------------- ----------------- --------  
*Regions* Полигональная (polygon features)  NAME (text)       `WGS_1984_UTM_Zone_32N` (импортируйте у слоя карты)
*Routes*  Линейная (line features)          -                 `WGS_1984_UTM_Zone_32N` (импортируйте у слоя карты)
*Places*  Точечная (point features)         NAME (text)       `WGS_1984_UTM_Zone_32N` (импортируйте у слоя карты)

По завершению создания слоёв они автоматически будут добавлены в таблицу содержания карты (Рис. \@ref(fig:mrg-lyrs)):

<div class="figure">
<img src="images/Ex05/image14.png" alt="Созданные слои в таблице содержания карты" width="30%" />
<p class="caption">(\#fig:mrg-lyrs)Созданные слои в таблице содержания карты</p>
</div>

## Векторизация регионов {#map-ref-general-digitizing}
[В начало упражнения ⇡](#map-ref-general)

1. Прочитайте параграф [**Редактирование**](#manual-edit) в разделе **Описание функций**.

1. Оставьте включенными только слои *Regions*, *SwissRegions* и *Countries*.

1. Уберите *прозрачность* у слоя *SwissRegions*.

1. Откройте сеанс редактирования для слоя *Regions*. Появится панель редактирования **Editor**, а также окно шаблонов объектов **Create Features** (Рис. \@ref(fig:mrg-cre)):

    <div class="figure">
    <img src="images/Ex05/image15.png" alt="Панель Editor и окно Create Features" width="100%" />
    <p class="caption">(\#fig:mrg-cre)Панель Editor и окно Create Features</p>
    </div>

1. Щелкните на шаблоне объекта *Regions* в окне **Create Features** и выберите режим создания объектов **Polygon** (Рис. \@ref(fig:mrg-pol)):

    <div class="figure">
    <img src="images/Ex05/image16.png" alt="Выбор режима создания объектов" width="30%" />
    <p class="caption">(\#fig:mrg-pol)Выбор режима создания объектов</p>
    </div>

1. Последовательно щелкая мышкой на точках вдоль границы, обведите регион *Prealpine Zones* (Предальпийские зоны) в центре карты. По завершению дважды щелкните мышкой (Рис. \@ref(fig:mrg-alp)):

    <div class="figure">
    <img src="images/Ex05/image17.png" alt="Ручная векторизация границы Предальпийской зоны" width="100%" />
    <p class="caption">(\#fig:mrg-alp)Ручная векторизация границы Предальпийской зоны</p>
    </div>

1. Чтобы появилась возможность пристыковать остальные регионы к границам стран, **выделите** в слое *Countries* все страны, кроме Швейцарии, **скопируйте** их в буфер обмена и **вставьте** в слой *Regions* (Рис. \@ref(fig:mrg-bnd)):
    
    <div class="figure">
    <img src="images/Ex05/image18.png" alt="Вставка границ стран в слой с границами физико-географических зон" width="100%" />
    <p class="caption">(\#fig:mrg-bnd)Вставка границ стран в слой с границами физико-географических зон</p>
    </div>

1. Выделите опять шаблон *Regions* в окне **Create Features**.

1. Используя режим **Auto-Complete Polygon**, оцифруйте границы оставшихся регионов в следующем порядке:

    - Сначала небольшие регионы, примыкающие к границам (Рис. \@ref(fig:mrg-breg)):

    <div class="figure">
    <img src="images/Ex05/image19.png" alt="Регионы, примыкающие к границе" width="100%" />
    <p class="caption">(\#fig:mrg-breg)Регионы, примыкающие к границе</p>
    </div>

    - Затем область второго порядка дальности от границы (горы *Юра*, Рис. \@ref(fig:mrg-jura)):

    <div class="figure">
    <img src="images/Ex05/image20.png" alt="Векторизация региона гор Юра" width="100%" />
    <p class="caption">(\#fig:mrg-jura)Векторизация региона гор Юра</p>
    </div>

    - Наконец, границу между центральными регионами (Рис. \@ref(fig:mrg-cnt)):

    <div class="figure">
    <img src="images/Ex05/image21.png" alt="Граница между центральными регионами" width="100%" />
    <p class="caption">(\#fig:mrg-cnt)Граница между центральными регионами</p>
    </div>

1. Выделите в слое *Regions* границы стран и удалите их.

1. Выберите команду **Editor > Save Edits**, чтобы сохранить результаты редактирования (Рис. \@ref(fig:mrg-cntr)).

<div class="figure">
<img src="images/Ex05/image22.png" alt="Результат векторизации границ физико-географических регионов" width="100%" />
<p class="caption">(\#fig:mrg-cntr)Результат векторизации границ физико-географических регионов</p>
</div>

<kbd>**Снимок экрана №3**. Векторный слой физико-географических регионов</kbd>

## Атрибутирование регионов {#map-ref-general-attributes}
[В начало упражнения ⇡](#map-ref-general)

1. Уберите заливку регионов, линии сделайте толщиной 1.5-2 пиксела (Рис. \@ref(fig:mrg-out)):

    <div class="figure">
    <img src="images/Ex05/image23.png" alt="Оформление границ регионов" width="100%" />
    <p class="caption">(\#fig:mrg-out)Оформление границ регионов</p>
    </div>

1. Откройте атрибутивную таблицу слоя *Regions*.

1. Поочередно выделяя каждый объект в таблице или на карте, заполните его атрибуты в соответствии с легендой (Рис. \@ref(fig:mrg-att)):

    <div class="figure">
    <img src="images/Ex05/image24.png" alt="Заполнение атрибутов объектов" width="100%" />
    <p class="caption">(\#fig:mrg-att)Заполнение атрибутов объектов</p>
    </div>

1. Сохраните изменения и завершите сеанс редактирования.

<kbd>**Снимок экрана №4**. Атрибутированные регионы</kbd>

## Цифрование маршрутов и точек интереса {#map-ref-general-routes-poi}
[В начало упражнения ⇡](#map-ref-general)

1. Выключите слои *Regions* и *SwissRegions.gif*.

1. Включите слои *WinSafariRoute*, *Routes* и *Places*.

1. Оцифруйте объекты слоев *Places* и *Routes*, используя инструменты панели **Сreate Features**:

    - Начните с расстановки точек населённых пунктов (Рис. \@ref(fig:mrg-pop)):

    <div class="figure">
    <img src="images/Ex05/image25.png" alt="Расстановка точек населенных пунктов" width="100%" />
    <p class="caption">(\#fig:mrg-pop)Расстановка точек населенных пунктов</p>
    </div>

    - Увеличьте масштаб, чтобы были хорошо видны изгибы линий (Рис. \@ref(fig:mrg-bds)):

    <div class="figure">
    <img src="images/Ex05/image26.png" alt="Линии маршрутов при увеличенном масштабе" width="100%" />
    <p class="caption">(\#fig:mrg-bds)Линии маршрутов при увеличенном масштабе</p>
    </div>

    - Проведите линии через получившиеся точки, повторяя контур исходной линии на растровой подложке. Каждую линию начинайте в точке и завершайте двойным щелчком в перекрестке (Рис. \@ref(fig:mrg-rts)):

    <div class="figure">
    <img src="images/Ex05/image27.png" alt="Векторизация линий маршрутов" width="100%" />
    <p class="caption">(\#fig:mrg-rts)Векторизация линий маршрутов</p>
    </div>

    После выполнения ручной векторизации всех маршрутов изображение должно принять примерно следующий вид (Рис. \@ref(fig:mrg-vrts)):
    
    <div class="figure">
    <img src="images/Ex05/image28.png" alt="Векторизованные линии маршрутов" width="100%" />
    <p class="caption">(\#fig:mrg-vrts)Векторизованные линии маршрутов</p>
    </div>

1. Заполните названия городов в слое *Places* (Рис. \@ref(fig:mrg-popn)).

    <div class="figure">
    <img src="images/Ex05/image29.png" alt="Заполнение названий городов в атрибутах точек" width="100%" />
    <p class="caption">(\#fig:mrg-popn)Заполнение названий городов в атрибутах точек</p>
    </div>

1. Сохраните изменения и завершите сеанс редактирования.

<kbd>**Снимок экрана №5**. Слои маршрута и пунктов назначения</kbd>

## Оформление карты {#map-ref-general-design}
[В начало упражнения ⇡](#map-ref-general)

1. Оставьте включенными слои *Regions*, *Routes*, *Places* и *Countries*. Остальные слои выключите.

1. Уберите заливку у слоя *Countries*.

1. Оформите слой *Regions* методом категорий по полю *NAME* (Рис. \@ref(fig:mrg-symreg)):

    <div class="figure">
    <img src="images/Ex05/image30.png" alt="Настройка визуализации слоя Regions" width="100%" />
    <p class="caption">(\#fig:mrg-symreg)Настройка визуализации слоя Regions</p>
    </div>
    
1. Оформите слои *Routes* и *Places* по аналогии с нижеприведенным фрагментом (Рис. \@ref(fig:mrg-sympop)):

    <div class="figure">
    <img src="images/Ex05/image31.png" alt="Образец оформления слоёв Routes и Places" width="100%" />
    <p class="caption">(\#fig:mrg-sympop)Образец оформления слоёв Routes и Places</p>
    </div>

1. Откройте панель **Labeling** и включите **Maplex** для размещения подписей.

1. Включите подписи для слоя *Places* со следующими настройками:

    Параметр                Значение
    ----------------------- ---------
    *Поле для подписей*     NAME
    *Шрифт*                 Tahoma
    *Кегль (размер)*        12
    *Цвет*                  Черный
    *Начертание*            Обычное

    После настройки подписей картографическое изображение должно принять приблизительно следующий вид (Рис. \@ref(fig:mrg-labpop)):
    
    <div class="figure">
    <img src="images/Ex05/image32.png" alt="Подписи населенных пунктов" width="100%" />
    <p class="caption">(\#fig:mrg-labpop)Подписи населенных пунктов</p>
    </div>

Некоторые подписи могут быть размещены не очень удачно. Чтобы они не перекрывали линии маршрута и значки выполните следующие действия:

1. Откройте *настройки весов подписей* **Label Weight Ranking** на панели **Labeling**

1. Установите вес равным *1000* слоям *Places* и *Routes* (Рис. \@ref(fig:mrg-labwgt)):

    <div class="figure">
    <img src="images/Ex05/image33.png" alt="Редактирование весов для слоёв карты" width="100%" />
    <p class="caption">(\#fig:mrg-labwgt)Редактирование весов для слоёв карты</p>
    </div>

    После настройки весов слоев количество графических конфликтов должно существенно уменьшиться (Рис. \@ref(fig:mrg-labres)):
    <div class="figure">
    <img src="images/Ex05/image34.png" alt="Отображение подписей после настройки весов слоёв" width="100%" />
    <p class="caption">(\#fig:mrg-labres)Отображение подписей после настройки весов слоёв</p>
    </div>

1. Добавьте на карту слой аналитической отмывки рельефа *Hillshade* из базы данных упражнения 3, разместите его над слоем Regions и установите прозрачность _80%_ (Рис. \@ref(fig:mrg-hill)):

    <div class="figure">
    <img src="images/Ex05/image35.png" alt="Карта со слоем аналитической отмывки" width="100%" />
    <p class="caption">(\#fig:mrg-hill)Карта со слоем аналитической отмывки</p>
    </div>

1. Добавьте на карту слой *Lakes* и присвойте ему символ полигона с голубой заливкой без обводки (Рис. \@ref(fig:mrg-lakes)).

    <div class="figure">
    <img src="images/Ex05/image36.png" alt="Карта со слоем озёр" width="100%" />
    <p class="caption">(\#fig:mrg-lakes)Карта со слоем озёр</p>
    </div>

<kbd>**Снимок экрана №6**. Оформление карты</kbd>

## Компоновка карты {#map-ref-general-layout}
[В начало упражнения ⇡](#map-ref-general)

1. Переключитесь в **режим компоновки**.

1. Установите альбомную ориентировку листа.

1. Оформите компоновку в соответствии с нижеприведенным образцом (Рис. \@ref(fig:mrg-lay)):

    <div class="figure">
    <img src="images/Ex05/image37.png" alt="Образец компоновки карты" width="100%" />
    <p class="caption">(\#fig:mrg-lay)Образец компоновки карты</p>
    </div>

    <kbd>**Снимок экрана №7**. Компоновка карты</kbd>
    
1. Экспортируйте карту в формат <kbd>PNG</kbd> с разрешением *300 dpi*.

1. Сохраните документ карты.

## Контрольные вопросы {#map-ref-general-questions}
[В начало упражнения ⇡](#map-ref-general)

1. Какова последовательность действий при создании каждой контрольной точки? Каково оптимальное расположение контрольных точек?

1. Какой метод трансформирования изображения вы использовали в работе?

1. Как пристыковать один полигон к другому, не оцифровывая их общую границу? Опишите последовательность действий.
